# cbeta 大藏经(大正藏)开源阅读计划

因为cbeta是用C++写的，我这里没有正版windows，所以一直是把cbeta光盘中的xml拷贝下来，自己处理之后阅读。
最近cbeta的xml格式发生了变化。所以重写了我的程序。随便共享出来给有需要的人。

## 主要目的

1. 是能在线阅读大藏经,所以主要精力放在排版阅读上面

## cbeta存在的问题
1. 使用图片显示悉昙字,蘭扎字，使用 组字式显示异体字,显示效果差
2. 光盘版是C++写的，Windows only
3. 光盘版不稳定，容易死机，速度也不理想
4. 原始xml文件的质量存在问题，希望可以持续改进

## 技术方式和预期效果

1. 速度.目前来看相比CBETA速度快上很多。完全不消耗服务器资源。对浏览器的消耗也非常小。速度非常快。CBETA在多处有卡顿的现象。原因不明，阅读体验不佳
目前唯一发现有些微卡顿的是' 胎藏梵字真言上卷', (T18/T18n0854_001.xml), 原因是使用了太多的图片和文件比较大所导致
2. 代码非常少。修改部署容易
3. 正确的显示
4. 简体字与繁体字都可以正常搜索内容
5. 自制的悉昙字字体已经正常, 使用Unicode10.0的码表来显现, ttf文件只有9k大小
6. 整体程序非常简单。只有一个tei.xsl文件和一个tei.css文件作为显示效果。而阅读效果比较好。修改简单方便，适合长期阅读藏经使用。

## 技术方式

1. 使用xslt来处理xml, 然后使用在xml中直接嵌入xslt的方式, 就可以直接在浏览器中阅读了。
如果希望自己使用的人, 可以自己搭建一个nginx服务器。将静态文件指向xml和tei.xsl,tei.css文件所在目录即可

2. 使用python来处理其他事情, 以及动态生成xslt文件， 主要是生成目录

3. 尽量少的使用js控制， 对搜索引擎友好

4. 在线直接阅读xml文件. 不单独生成html，占用空间小。其他格式文件也可以直接在线生成

## 使用说明

1. tei.xsl是用来处理大藏经中的xml文件的.
2. tei.css是用来调整显示效果的。
3. 首先把cbeta中的xml文件拷贝出来到一个目录比如TMP，然后拷贝上述两个文件到TMP目录。
4. 启动nginx服务器，设置静态目录为TMP。一个不错的阅经环境就设置完成了

## 工作到一半的时候发现已经有了
http://cbetaonline.dila.edu.tw/zh/T1579_011
但是技术没有公开, 而且还有显示问题

## TODO
1. 目前只能阅读， 目录还没有加上   # DONE!
2. 使用whoosh方案做全文搜索，支持复杂的查询语法, 使查询变得更加简单
3. 做一个组字式的替换表，以便在阅读中显示正常汉字
4. 删除悉昙字的图片，使用Unicode10.0的字来显现。目前字体做了一半，不会做那种可以移动的符号
5. 删除蘭扎字的图片，暂时设想使用悉昙字的变体来实现
6. 删除异体字和组字式

## 目前存在的问题
1.搜索生成的索引文件太大了, 整整有4G，查找一次使用时间太长，需要15～20秒。搜索结果不理想
